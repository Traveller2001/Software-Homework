[github在这](https://github.com/VJJJJJJ1/032002534)

# 一、PSP表格

| PSP2.1                                | Personal Software Process Stages       | 预估耗时 （分钟） | 实际耗时 （分钟） |
| ------------------------------------- | -------------------------------------- | ----------------- | ----------------- |
| Planning                              | 计划                                   | 30                | 20                |
| Estimate                              | 估计这个任务需要多少时间               | 30                | 30                |
| Development                           | 开发                                   | 900               | 800               |
| Analysis                              | 需求分析 (包括学习新技术)              | 1500              | 1600              |
| Design Spec                           | 生成设计文档                           | 10                | 10                |
| Design Review                         | 设计复审                               | 10                | 10                |
| Coding Standard                       | 代码规范 (为目前的开发制 定合适的规范) | 5                 | 25                |
| Design                                | 具体设计                               | 200               | 300               |
| Coding                                | 具体编码                               | 500               | 400               |
| Code Review                           | 代码复审                               | 500               | 500               |
| Test                                  | 测试（自我测试，修改代 码，提交修改）  | 300               | 300               |
| Reporting                             | 报告                                   | 15                | 15                |
| Test Repor                            | 测试报告                               | 15                | 15                |
| Size Measurement                      | 计算工作量                             | 10                | 10                |
| Postmortem & Process Improvement Plan | 事后总结, 并提出过程改进 计划          | 100               | 100               |
|                                       | 合计                                   | 4125              | 4135              |



# 二、任务要求的实现
### （2.1）项目设计与技术栈
从阅读题目到完成作业，这次任务被我拆成4个环节：

- 1、爬取卫健委所有文本数据
- 2、文本处理，提取有用信息
- 3、将提取到的信息写入excel表格
- 4、数据可视化处理 

> 1、爬虫部分：利用了python的requests库和BeautifulSoup库对国家卫健委网页进行爬取，主要的学习渠道是中国大学慕课和哔哩哔哩
> 2、文本提取：利用正则表达式对爬取的网页信息进行提取 [链接在这](https://www.runoob.com/python/python-reg-expressions.html)
> 3、数据写入：利用python的xlwt库创建并写入excel文件，利用xlutils库对已创建的excel文件进行编辑，主要是通过搜索网上的博客进行学习。
> 4、数据可视化：利用pyecharts对数据进行可视化处理 [点我]([pyecharts - A Python Echarts Plotting Library built with love.](https://pyecharts.org/#/))

#### 技术栈：python、正则表达式、pyecharts

### （2.2）爬虫与数据处理

这次的编程作业一共有七个程序：

- ```myData.py```
- ```大陆新增确诊及无症状.py```
- ```大陆各省份新增无症状.py```
- ```各省份新增确诊.py```
- ```港澳台疫情数据.py```
- ```可视化处理各省新增确诊.py```
- ```可视化处理各省新增无症状.py```

```myData```是爬虫的最主要部分，里面的```getHTMLText``` 返回该网页的所有文本信息，在主函数里利用正则表达式对```getHTMLText``` 函数返回的text作信息提取，将每一天的疫情信息提取成例如```2020-04-11:4例为本土病例（广东3例，黑龙江1例）``` 的形式，同理，无症状感染和港澳台确诊信息也都以这种形式记录。在爬取网页时会发现疫情通报板块有很多标题，每个标题对应每天的疫情数据，所以这里采用了python的bs4库对返回的html文本进行解析，然后复用```getHTMLText``` 函数去获取每天的疫情通报详细信息。

```大陆新增确诊及无症状.py``` 是对中国大陆每日本土新增确诊人数及新增无症状感染人数的统计，并将其写入excel

```大陆各省份新增无症状.py  各省份新增确诊.py  港澳台疫情数据.py``` 是统计我国各个省的每日新增确诊人数和新增无症状感染人数，主要用到正则表达式和python的xlwt库，其中的数据不包含港澳台每日新增无症状感染人数。由于国家卫健委只发布了港澳台的累计确诊数据，所以这个模块的代码并没有获取到港澳台的无症状感染数据，同时，获取港澳台每日新增确诊病例，这里是将当日累计确诊减去前一天的累计确诊得来的。

```可视化处理各省新增确诊.py``` 和 ```可视化处理各省新增无症状.py```这个模块是利用python的 [pyecharts]([pyecharts - A Python Echarts Plotting Library built with love.](https://pyecharts.org/#/))进行处理，这里用的是pyecharts中的```Geo()``` 类进行绘制图像，设置背景色、主标题、副标题等后，生成若干个html文件，里面即本次所需要的疫情数据。



### (2.3)数据统计接口部分的性能改进

![](https://img2022.cnblogs.com/blog/2288863/202209/2288863-20220920193501093-1892782633.png)

消耗最大的是myData里面的```getHtml``` 函数

![](https://img2022.cnblogs.com/blog/2288863/202209/2288863-20220920193751280-1494820992.png)



### (2.4)每日热点的实现思路

~~我不会呜呜呜~~ 在努力了额

### (2.5)数据可视化界面的展示

大概长这样：

![](https://img2022.cnblogs.com/blog/2288863/202209/2288863-20220920173357247-1403410416.png)

代码如下：

```python
import xlrd
from pyecharts import options as opts
from pyecharts.charts import Geo
from pyecharts.globals import ChartType

data= xlrd.open_workbook('./所有省份新增确诊人数.xls')
data2 = xlrd.open_workbook('./大陆新增确诊及无症状人数.xls')


table = data.sheets()[0]     # 打开各省详细确诊数据的第一张表
table2 = data2.sheets()[0]   # 打开大陆确诊总数的第一张表


# 读入第一列作为时间,其中Time[0] = '时间'
Time = table.col_values(0)
# 读入第一行省份
Province = table.row_values(0)
# 读入大陆土新增确诊人数
total = table2.col_values(1)
for row_idx in range(1, len(Time)):
    Total = int(total[row_idx])
    z = []
    rowi = table.row_values(row_idx)   # rowi[0]是时间，后面是疫情数据
    for col_idx in range(1, len(Province)):

       # idx为列索引的位置
        if rowi[col_idx] == 0:
            continue
        tmp_tuple = (Province[col_idx], rowi[col_idx])
        z.append(tmp_tuple)

    path = './所有省份新增确诊一览/' + Time[row_idx] + "所有省份新增确诊人数.html"
    geo = (
        Geo(init_opts=opts.InitOpts(width="1900px",height="910px", bg_color='pink', page_title=Time[row_idx] + "所有省份新增确诊人数"))
            .add_schema(maptype="china" )
            .add(
            "新增省份",
            z,
            type_=ChartType.EFFECT_SCATTER,
        )
            .set_series_opts(label_opts=opts.LabelOpts(is_show=False))
            .set_global_opts(title_opts=opts.TitleOpts(title=Time[row_idx] + "所有省份新增确诊人数",pos_left="center",
                                                       subtitle = '今日中国大陆新增确诊人数：' + str(Total),
                                                       title_textstyle_opts=opts.TextStyleOpts(font_size=50)),
                             legend_opts=opts.LegendOpts(pos_right="28%", pos_bottom="32%", is_show=True),
                             visualmap_opts=opts.VisualMapOpts(max_=2000, pos_left="10%",pos_bottom="10%")
                             )

            .render(path)
    )
```

###### 以上图2022-04-04所有省份新增确诊为例，本次使用pyecharts库的geo进行绘图，其中包括最核心的中国地图、视觉映射组件、图例、主标题和副标题。右下角的视觉映射组件用不同颜色来区分不同新增确诊/无症状人数右边的红色点是图例，在中国地图中，出现圆点就说明这一天有新增确诊，副标题是对中国大陆当日新增确诊人数的汇总。最后，设置整个可视化图的背景色为粉色，就完成了数据的可视化。

# 三、心得体会

这次作业对我来说很极限了，从爬虫爬不明白到完成可视化页面的展示，一步一步学下来收获也不少。这次作业让我觉得最棘手的地方就是国家卫健委在不同时期发布的疫情通报格式都不一样，导致我在匹配提取有用信息的时候一直会漏掉一些格式，除此之外，有时候国家卫健委会在一天发两条通告，这样就会让我额外提取到不同格式的信息，导致我在处理数据的时候格外痛苦，外加卫健委网站的反爬机制，让我经常在爬的时候爬不完全，因此进行编译调试一次代码需要花费很多时间。第一次看到这个任务的时候总觉得自己完成不了，很害怕这个任务，自从听到结对作业的大致要求后，回头想想个人编程好像也没那么可怕了。

